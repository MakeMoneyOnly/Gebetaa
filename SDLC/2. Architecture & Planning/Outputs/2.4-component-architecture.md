# Phase 2.4: Component Architecture

**Status:** APPROVED
**Date:** 2026-02-04
**Skill Invoked:** /component-architecture
**Context:** Defining the structural blueprints for Gebeta's frontend.

---

## 1. Project Structure (Feature-Based)

We adopt a **Feature-Sliced Design** approach to ensure scalability for the Monorepo.

```
src/
├── app/                  # Next.js App Router (Routing Only)
│   ├── (public)/         # Public facing pages (Menu)
│   ├── (admin)/          # Admin Dashboard pages
│   └── api/              # API Routes (if needed beyond Server Actions)
├── components/           # Shared "Atomic" Components
│   ├── ui/               # Primitives (Button, Input, Card) - Shadcn-like
│   ├── layout/           # Global Layouts (Header, Sidebar)
│   └── providers/        # Context Providers (Query, Theme)
├── features/             # Business Logic Domains
│   ├── menu/             # Menu Viewing Logic
│   │   ├── components/   # MenuCard, CategoryPills
│   │   ├── store/        # Zustand (Cart State)
│   │   └── actions.ts    # Server Actions (Fetch Menu)
│   ├── order/            # Ordering Logic
│   │   ├── hooks/        # useOrderSync
│   │   └── utils/        # Price calculators
│   └── admin/            # Admin Logic
│       ├── components/   # DashboardCharts
│       └── hooks/        # useSalesData
├── lib/                  # Shared Utilities
│   ├── db/               # Supabase Client
│   └── utils.ts          # CN, Formatters
└── types/                # Global TypeScript Definitions
```

---

## 2. Core "Atomic" Components (Primitives)

These components live in `src/components/ui` and follow the **Design System**.

### Button (`<Button />`)
*   **Variants:** `primary` (Crimson), `secondary` (Outline), `ghost` (Text), `glass` (Frosted).
*   **Sizes:** `sm` (32px), `md` (44px), `lg` (56px).
*   **Behavior:** Supports `loading` prop (Spinner).

### Card (`<Card />`)
*   **Variants:** `default` (White/Dark), `glass` (Blur).
*   **Slots:** `Header`, `Content`, `Footer`.
*   **Elevation:** `shadow-card`, `shadow-glow`.

### StatusBadge (`<StatusBadge />`)
*   **Variants:** `success` (Green), `warning` (Amber), `error` (Red), `neutral` (Gray).
*   **Usage:** Order Status, Stock Availability.

---

## 3. Complex Organisms (features/*)

### `MenuGrid` (features/menu)
*   **Responsibility:** Renders localized categories and items.
*   **Optimization:** Virtualized list for large menus (future proof).
*   **Interaction:** Swipe to change category.

### `CartSheet` (features/menu)
*   **Type:** Drawer/Sheet (Mobile) / Sidebar (Desktop).
*   **State:** Connects to `useCartStore`.
*   **Offline:** Persists to `localStorage` / `Dexie`.

### `OrderSyncIndicator` (features/order)
*   **Responsibility:** Visual cues of connectivity.
*   **States:** `Connected` (Green Node), `Syncing` (Spinning), `Offline` (Amber Cloud).

---

## 4. Data Fetching Strategy

### Server Components (RSC)
*   **Role:** Fetch initial data (Menu, Restaurant Info) directly from Supabase.
*   **Caching:** aggressive `revalidate: 3600` (1 hour) for Menus.

### Client Components
*   **Role:** User interactivity (Cart, Filtering).
*   **Mutation:** Use **Server Actions** (`createOrder`, `updateItem`).
*   **State:** **TanStack Query** for async state (optimistic updates).

---

## 5. State Management (Zustand)

### `useCartStore`
```ts
interface CartState {
  items: CartItem[];
  addItem: (item: MenuItem) => void;
  removeItem: (id: string) => void;
  total: number;
}
```

### `useConnectivityStore`
```ts
interface ConnectivityState {
  isOnline: boolean;
  pendingOrders: Order[];
  syncStatus: 'idle' | 'syncing' | 'error';
}
```
